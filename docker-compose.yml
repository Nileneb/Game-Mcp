version: '3.8'
services:
  paperstream:
    build: .
    container_name: paperstream
    environment:
      - FASTMCP_HOST=0.0.0.0
      - FASTMCP_PORT=8082
      - SSE_PATH=/sse-paperstream
      - RESULT_PATH=/paper-result
      - ASSIGN_TTL=120
      - MAX_INFLIGHT_PER_CLIENT=2
      - PAPERSTREAM_HMAC=${PAPERSTREAM_HMAC:-}
    ports:
      - "8082:8082"
    restart: unless-stopped

  iot-test:
    build: .
    container_name: iot-test
    depends_on:
      - paperstream
    entrypoint: ["/bin/sh", "-c", "python -m venv /venv && . /venv/bin/activate && pip install --upgrade pip && pip install requests sseclient && sleep 5 && python /app/simulate_iot_device.py"]
    environment:
      - FASTMCP_HOST=paperstream
    restart: "no"
